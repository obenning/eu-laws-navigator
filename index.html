<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EU-Gesetzes Navigator - API-Powered</title>
    <style>
        .euaml-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .euaml-header {
            background: linear-gradient(135deg, #063AA8 0%, #1E40AF 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .euaml-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .euaml-auto-badge {
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .euaml-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .euaml-law-selector {
            background: rgba(255,255,255,0.95);
            border: 1px solid rgba(255,255,255,0.2);
            color: #063AA8;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 200px;
        }

        .euaml-refresh-btn {
            background: rgba(34, 197, 94, 0.9);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .euaml-refresh-btn:hover {
            background: rgba(34, 197, 94, 1);
            transform: translateY(-1px);
        }

        .euaml-content {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .euaml-info-banner {
            background: linear-gradient(90deg, #E0F2FE 0%, #F0F9FF 100%);
            border-bottom: 1px solid #7DD3FC;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #0369A1;
        }

        .euaml-github-link {
            color: #1D4ED8;
            text-decoration: none;
            font-weight: 500;
        }

        .euaml-github-link:hover {
            text-decoration: underline;
        }

        .euaml-search-section {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
        }

        .euaml-search-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #DEE2E6;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .euaml-search-input:focus {
            outline: none;
            border-color: #063AA8;
            box-shadow: 0 0 0 3px rgba(6,58,168,0.1);
        }

        .euaml-main-content {
            overflow-y: auto;
            padding: 15px 20px;
            flex: 1;
        }

        .euaml-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .euaml-section:last-child {
            border-bottom: none;
        }

        .euaml-section-title {
            color: #063AA8;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .euaml-update-time {
            font-size: 11px;
            color: #666;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .euaml-article {
            margin: 8px 0;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .euaml-article:hover {
            background: #F0F5FF;
            border-color: #DEE2E6;
        }

        .euaml-article.euaml-active {
            background: #E6F0FF;
            border-color: #063AA8;
        }

        .euaml-content-match {
            background-color: #f0f7ff;
            border-left: 3px solid #063AA8;
        }

        .euaml-article-title {
            padding: 10px 12px;
            font-weight: 500;
            color: #333;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .euaml-article-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .euaml-article-content {
            display: none;
            padding: 20px;
            background: #FFFFFF;
            border-top: 1px solid #E2E8F0;
            font-size: 14px;
            line-height: 1.6;
            max-height: 60vh;
            overflow-y: auto;
            user-select: text;
            cursor: text;
        }

        .euaml-article.euaml-active .euaml-article-content {
            display: block;
        }

        .euaml-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: #666;
            flex-direction: column;
            gap: 15px;
        }

        .euaml-loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #063AA8;
            border-radius: 50%;
            animation: euaml-spin 1s linear infinite;
        }

        @keyframes euaml-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .euaml-error {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            color: #e53e3e;
            padding: 15px;
            border-radius: 4px;
            margin: 15px;
        }

        .euaml-success {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            color: #276749;
            padding: 15px;
            border-radius: 4px;
            margin: 15px;
        }

        .euaml-search-highlight {
            background-color: #fff3cd;
            padding: 0.1em 0.2em;
            border-radius: 0.2em;
            box-shadow: 0 0 0 1px #ffeeba;
        }

        .euaml-close-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            user-select: none;
        }

        .euaml-close-btn:hover {
            background: #e9ecef;
        }

        .law-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
        }

        .law-badge.eu-aml {
            background: #063AA8;
            color: white;
        }

        .law-badge.gdpr {
            background: #8B5CF6;
            color: white;
        }

        .law-badge.ai-act {
            background: #059669;
            color: white;
        }

        .law-badge.dsa {
            background: #DC2626;
            color: white;
        }

        /* Deutsche Gesetze Badges */
        .law-badge.de-gwg {
            background: #B91C1C;
            color: white;
        }

        .law-badge.de-kwg {
            background: #1F2937;
            color: white;
        }

        .law-badge.de-zag {
            background: #7C3AED;
            color: white;
        }

        .law-badge.de-awg {
            background: #EA580C;
            color: white;
        }

        .law-badge.de-awv {
            background: #F59E0B;
            color: white;
        }

        .law-badge.de-stgb {
            background: #991B1B;
            color: white;
        }

        .law-badge.de-vag {
            background: #0891B2;
            color: white;
        }

        .law-badge.de-kagb {
            background: #059669;
            color: white;
        }

        .law-badge.de-wphg {
            background: #0D9488;
            color: white;
        }

        .law-badge.de-sanktdg {
            background: #DC2626;
            color: white;
        }

        .law-badge.default {
            background: #6B7280;
            color: white;
        }

        /* API Content Styling */
        .api-content {
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }

        .api-content .law-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .api-content .law-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .api-content .law-meta {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 12px;
        }

        .api-content h1,
        .api-content h2,
        .api-content h3 {
            color: #1e40af;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
            margin: 20px 0 15px 0;
        }

        .api-content .paragraph {
            margin: 15px 0;
            padding: 10px;
            background: #f8fafc;
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
        }

        .api-content .paragraph-number {
            font-weight: 600;
            color: #1e40af;
            margin-right: 8px;
        }

        .content-type-indicator {
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
        }

        .content-type-indicator.api {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .content-type-indicator.fallback {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        @media (max-width: 768px) {
            .euaml-container {
                margin: 10px;
                border-radius: 4px;
                height: 95vh;
            }
            
            .euaml-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .euaml-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .euaml-law-selector {
                min-width: unset;
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="euaml-container" id="euamlContainer">
        <div class="euaml-header">
            <h1 class="euaml-title">
                üá™üá∫ EU-Gesetzes Navigator
                <span class="euaml-auto-badge">API-Powered</span>
            </h1>
            <div class="euaml-controls">
                <select class="euaml-law-selector" id="euamlLawSelector">
                    <optgroup label="üá™üá∫ EU-Verordnungen">
                        <option value="eu_aml_2024">EU-Geldw√§scheverordnung 2024</option>
                        <option value="eu_gdpr_2016">EU-Datenschutz-Grundverordnung (GDPR)</option>
                        <option value="eu_ai_act_2024">EU-KI-Verordnung (AI Act) 2024</option>
                        <option value="eu_dsa_2022">Digital Services Act 2022</option>
                    </optgroup>
                    <optgroup label="üè¶ Deutsche Gesetze - Geldw√§schepr√§vention">
                        <option value="de_gwg_2017">Geldw√§schegesetz (GwG)</option>
                        <option value="de_kwg">Kreditwesengesetz (KWG)</option>
                        <option value="de_zag_2018">Zahlungsdiensteaufsichtsgesetz (ZAG)</option>
                        <option value="de_vag_2016">Versicherungsaufsichtsgesetz (VAG)</option>
                    </optgroup>
                    <optgroup label="üåç Deutsche Gesetze - Sanktionen & Au√üenwirtschaft">
                        <option value="de_awg">Au√üenwirtschaftsgesetz (AWG)</option>
                        <option value="de_awv_2013">Au√üenwirtschaftsverordnung (AWV)</option>
                        <option value="de_eu_sanktdg">EU-Sanktions-Durchf√ºhrungsgesetz</option>
                    </optgroup>
                    <optgroup label="üìà Deutsche Gesetze - Kapitalmarkt & Investitionen">
                        <option value="de_kagb">Kapitalanlagegesetzbuch (KAGB)</option>
                        <option value="de_wphg">Wertpapierhandelsgesetz (WpHG)</option>
                    </optgroup>
                    <optgroup label="‚öñÔ∏è Deutsche Gesetze - Strafrecht">
                        <option value="de_stgb">Strafgesetzbuch (StGB) - ¬ß261 Geldw√§sche</option>
                    </optgroup>
                </select>
                <button class="euaml-refresh-btn" id="euamlRefreshBtn">üîÑ Neu laden</button>
            </div>
        </div>
        <div class="euaml-content" id="euamlContent">
            <div class="euaml-info-banner">
                <span>üöÄ</span>
                <span id="statusBanner">
                    <strong>API-Powered Auto-Update</strong> um 6:00 Uhr | 
                    üá™üá∫ EU: EUR-Lex | üèõÔ∏è DE: Open Legal Data API | 
                    <a href="#" class="euaml-github-link" id="githubLink" target="_blank">GitHub Actions</a>
                </span>
            </div>
            <div class="euaml-search-section">
                <input type="text" class="euaml-search-input" id="euamlSearchInput" 
                       placeholder="Suche nach Artikeln oder Begriffen... (z.B. 'Art. 1', 'Begriffsbestimmungen')">
            </div>
            <div class="euaml-main-content" id="euamlMainContent">
                <div class="euaml-loading">
                    <div class="euaml-loading-spinner"></div>
                    <span>Lade API-powered Gesetze...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            console.log('üöÄ API-Powered EU-Gesetzes Navigator startet...');
            
            // GitHub-Konfiguration automatisch ermitteln
            function detectGitHubConfig() {
                var currentHost = window.location.hostname;
                var currentPath = window.location.pathname;
                
                if (currentHost.includes('github.io')) {
                    var hostParts = currentHost.split('.');
                    var username = hostParts[0];
                    
                    var pathParts = currentPath.split('/').filter(Boolean);
                    var repository = pathParts[0] || 'eu-gesetzes-navigator';
                    
                    return {
                        username: username,
                        repository: repository,
                        branch: 'main'
                    };
                }
                
                console.warn('‚ö†Ô∏è WICHTIG: Passen Sie die GitHub-Konfiguration an!');
                return {
                    username: 'obenning',      // ‚ö†Ô∏è HIER ANPASSEN
                    repository: 'eu-laws-navigator',    // ‚ö†Ô∏è HIER ANPASSEN
                    branch: 'main'
                };
            }
            
            const GITHUB_CONFIG = detectGitHubConfig();
            console.log('üìÅ GitHub Config:', GITHUB_CONFIG);
            
            // Konfiguration der verf√ºgbaren Gesetze
            const AVAILABLE_LAWS = {
                // EU-Verordnungen
                'eu_aml_2024': {
                    name: 'EU-Geldw√§scheverordnung 2024',
                    shortName: 'EU-GwVO',
                    filename: 'eu-aml-2024.html',
                    celex: '32024R1624',
                    type: 'eu-regulation',
                    color: '#063AA8'
                },
                'eu_gdpr_2016': {
                    name: 'EU-Datenschutz-Grundverordnung',
                    shortName: 'GDPR',
                    filename: 'eu-gdpr-2016.html',
                    celex: '32016R0679',
                    type: 'eu-regulation',
                    color: '#8B5CF6'
                },
                'eu_ai_act_2024': {
                    name: 'EU-KI-Verordnung (AI Act)',
                    shortName: 'AI Act',
                    filename: 'eu-ai-act-2024.html',
                    celex: '32024R1689',
                    type: 'eu-regulation',
                    color: '#059669'
                },
                'eu_dsa_2022': {
                    name: 'Digital Services Act',
                    shortName: 'DSA',
                    filename: 'eu-dsa-2022.html',
                    celex: '32022R2065',
                    type: 'eu-regulation',
                    color: '#DC2626'
                },
                
                // Deutsche Gesetze (API-powered)
                'de_gwg_2017': {
                    name: 'Geldw√§schegesetz (GwG)',
                    shortName: 'GwG',
                    filename: 'de-gwg-2017.html',
                    type: 'german-law',
                    category: 'aml',
                    color: '#B91C1C'
                },
                'de_kwg': {
                    name: 'Kreditwesengesetz (KWG)',
                    shortName: 'KWG',
                    filename: 'de-kwg.html',
                    type: 'german-law',
                    category: 'banking',
                    color: '#1F2937'
                },
                'de_zag_2018': {
                    name: 'Zahlungsdiensteaufsichtsgesetz (ZAG)',
                    shortName: 'ZAG',
                    filename: 'de-zag-2018.html',
                    type: 'german-law',
                    category: 'payments',
                    color: '#7C3AED'
                },
                'de_awg': {
                    name: 'Au√üenwirtschaftsgesetz (AWG)',
                    shortName: 'AWG',
                    filename: 'de-awg.html',
                    type: 'german-law',
                    category: 'sanctions',
                    color: '#EA580C'
                },
                'de_awv_2013': {
                    name: 'Au√üenwirtschaftsverordnung (AWV)',
                    shortName: 'AWV',
                    filename: 'de-awv-2013.html',
                    type: 'german-law',
                    category: 'sanctions',
                    color: '#F59E0B'
                },
                'de_stgb': {
                    name: 'Strafgesetzbuch (StGB)',
                    shortName: 'StGB',
                    filename: 'de-stgb.html',
                    type: 'german-law',
                    category: 'criminal',
                    color: '#991B1B'
                },
                'de_vag_2016': {
                    name: 'Versicherungsaufsichtsgesetz (VAG)',
                    shortName: 'VAG',
                    filename: 'de-vag-2016.html',
                    type: 'german-law',
                    category: 'insurance',
                    color: '#0891B2'
                },
                'de_kagb': {
                    name: 'Kapitalanlagegesetzbuch (KAGB)',
                    shortName: 'KAGB',
                    filename: 'de-kagb.html',
                    type: 'german-law',
                    category: 'investments',
                    color: '#059669'
                },
                'de_wphg': {
                    name: 'Wertpapierhandelsgesetz (WpHG)',
                    shortName: 'WpHG',
                    filename: 'de-wphg.html',
                    type: 'german-law',
                    category: 'securities',
                    color: '#0D9488'
                },
                'de_eu_sanktdg': {
                    name: 'EU-Sanktions-Durchf√ºhrungsgesetz',
                    shortName: 'EU-SanktDG',
                    filename: 'de-eu-sanktdg.html',
                    type: 'german-law',
                    category: 'sanctions',
                    color: '#DC2626'
                }
            };
            
            var currentLaw = 'eu_aml_2024';
            var sections = [];
            var articleContents = new Map();
            var searchTimeout = null;
            var lastUpdateTime = null;
            var currentContentType = 'unknown';
            
            var container = null;
            var content = null;
            var searchInput = null;
            var mainContent = null;
            var lawSelector = null;
            var refreshBtn = null;
            var githubLink = null;
            var statusBanner = null;
            
            function initElements() {
                container = document.getElementById('euamlContainer');
                content = document.getElementById('euamlContent');
                searchInput = document.getElementById('euamlSearchInput');
                mainContent = document.getElementById('euamlMainContent');
                lawSelector = document.getElementById('euamlLawSelector');
                refreshBtn = document.getElementById('euamlRefreshBtn');
                githubLink = document.getElementById('githubLink');
                statusBanner = document.getElementById('statusBanner');
                
                if (githubLink) {
                    githubLink.href = `https://github.com/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repository}/tree/${GITHUB_CONFIG.branch}/laws`;
                }

                if (!container || !content || !searchInput || !mainContent || !lawSelector) {
                    console.error('‚ùå Konnte nicht alle DOM-Elemente finden');
                    return false;
                }
                return true;
            }
            
            function showError(message) {
                if (mainContent) {
                    mainContent.innerHTML = 
                        '<div class="euaml-error">' +
                        '<strong>Fehler:</strong><br>' + message +
                        '<br><br>' +
                        'üí° <strong>Tipp:</strong> Pr√ºfen Sie die GitHub-Repository-Konfiguration.' +
                        '<br><strong>Aktuell:</strong> ' + GITHUB_CONFIG.username + '/' + GITHUB_CONFIG.repository +
                        '</div>';
                }
            }
            
            function showSuccess(message) {
                if (mainContent) {
                    var notification = document.createElement('div');
                    notification.className = 'euaml-success';
                    notification.innerHTML = message;
                    mainContent.insertBefore(notification, mainContent.firstChild);
                    
                    setTimeout(function() {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 4000);
                }
            }
            
            function getGitHubRawUrl(filename) {
                return `https://raw.githubusercontent.com/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repository}/${GITHUB_CONFIG.branch}/laws/${filename}`;
            }
            
            async function loadUpdateMetadata() {
                try {
                    const metadataUrl = getGitHubRawUrl('last-update.json');
                    console.log('üìä Lade Metadaten:', metadataUrl);
                    
                    const response = await fetch(metadataUrl + '?t=' + Date.now());
                    
                    if (!response.ok) {
                        throw new Error(`Metadaten nicht verf√ºgbar: ${response.status}`);
                    }
                    
                    const metadata = await response.json();
                    lastUpdateTime = new Date(metadata.last_update);
                    
                    console.log('‚úÖ Metadaten geladen:', lastUpdateTime.toLocaleString('de-DE'));
                    updateStatusBanner(metadata);
                    
                    return metadata;
                    
                } catch (error) {
                    console.warn('‚ö†Ô∏è Metadaten nicht verf√ºgbar:', error);
                    return null;
                }
            }
            
            function updateStatusBanner(metadata) {
                if (!statusBanner || !metadata) return;
                
                const stats = metadata.statistics || {};
                const euStats = stats.eu_laws || {};
                const deStats = stats.german_laws || {};
                
                const euCount = euStats.available || 0;
                const deRealCount = deStats.real_api_content || 0;
                const deFallbackCount = deStats.api_fallbacks || 0;
                
                statusBanner.innerHTML = `
                    <strong>API-Powered Auto-Update</strong> um 6:00 Uhr | 
                    üá™üá∫ EU: ${euCount}/4 (${euStats.success_rate || '0%'}) | 
                    üèõÔ∏è DE-API: ${deRealCount}/10 | 
                    üìÑ DE-Links: ${deFallbackCount}/10 | 
                    <a href="#" class="euaml-github-link" id="githubLink" target="_blank">Open Legal Data</a>
                `;
                
                const newGithubLink = document.getElementById('githubLink');
                if (newGithubLink) {
                    newGithubLink.href = `https://de.openlegaldata.io/`;
                }
            }
            
            async function loadFromGitHub(lawConfig) {
                console.log('üì• Lade:', lawConfig.name);
                
                if (mainContent) {
                    mainContent.innerHTML = 
                        '<div class="euaml-loading">' +
                        '<div class="euaml-loading-spinner"></div>' +
                        '<span>Lade ' + lawConfig.name + ' (API-powered)...</span>' +
                        '</div>';
                }
                
                try {
                    await loadUpdateMetadata();
                    
                    const fileUrl = getGitHubRawUrl(lawConfig.filename);
                    console.log('üìÑ Lade von:', fileUrl);
                    
                    const response = await fetch(fileUrl + '?t=' + Date.now(), {
                        method: 'GET',
                        cache: 'no-cache'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const html = await response.text();
                    
                    if (!html || html.length < 500) {
                        throw new Error('Datei zu kurz oder leer');
                    }
                    
                    console.log('‚úÖ', lawConfig.name + ' geladen:', html.length, 'Zeichen');
                    
                    const contentType = analyzeContentType(html);
                    currentContentType = contentType;
                    
                    console.log('üîç Content-Typ:', contentType);
                    
                    parseContent(html, lawConfig, contentType);
                    
                    const updateInfo = lastUpdateTime ? 
                        ` (Update: ${lastUpdateTime.toLocaleString('de-DE')})` : '';
                    const typeInfo = getContentTypeDescription(contentType);
                    showSuccess(`‚úÖ ${lawConfig.name} geladen!${typeInfo}${updateInfo}`);
                    
                } catch (error) {
                    console.error('‚ùå Fehler:', error);
                    showError(`Fehler beim Laden von ${lawConfig.name}: ${error.message}<br><br>` +
                        `Repository: ${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repository}`);
                    loadFallback(lawConfig);
                }
            }
            
            function analyzeContentType(html) {
                // Pr√ºfe auf API-Content
                if (html.includes('Open Legal Data API') || html.includes('law-header')) {
                    return 'api';
                }
                
                // Pr√ºfe auf EU-Content  
                if (html.includes('eur-lex.europa.eu') || html.includes('CELEX') || html.includes('oj-sti-art')) {
                    return 'eu-original';
                }
                
                // Pr√ºfe auf Fallback
                if (html.includes('API-Zugriff tempor√§r') || html.includes('Enhanced Redirect')) {
                    return 'fallback';
                }
                
                // Standard EU-HTML
                if (html.includes('Art.') || html.includes('Artikel')) {
                    return 'eu-original';
                }
                
                return 'unknown';
            }
            
            function getContentTypeDescription(contentType) {
                switch (contentType) {
                    case 'api':
                        return ' (Open Legal Data API)';
                    case 'eu-original':
                        return ' (EUR-Lex Original)';
                    case 'fallback':
                        return ' (API-Fallback mit direkten Links)';
                    default:
                        return ' (Gesetzesinhalt)';
                }
            }
            
            function parseContent(html, lawConfig, contentType) {
                try {
                    console.log('üîß Parse:', lawConfig.name, '(Typ:', contentType + ')');
                    
                    var tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    
                    if (contentType === 'api') {
                        parseAPIContent(tempDiv, lawConfig);
                    } else if (contentType === 'fallback') {
                        parseFallbackContent(tempDiv, lawConfig);
                    } else if (contentType === 'eu-original') {
                        parseEUContent(tempDiv, lawConfig);
                    } else {
                        // Versuche automatische Erkennung
                        if (!parseEUContent(tempDiv, lawConfig) && !parseAPIContent(tempDiv, lawConfig)) {
                            parseFallbackContent(tempDiv, lawConfig);
                        }
                    }
                    
                    renderSections();
                    console.log('‚úÖ Parsing erfolgreich:', sections.length, 'Abschnitte');
                    
                } catch (error) {
                    console.error('‚ùå Parse-Fehler:', error);
                    loadFallback(lawConfig);
                }
            }
            
            function parseAPIContent(tempDiv, lawConfig) {
                console.log('üîå Verarbeite API-Content');
                
                // Finde alle Paragraphen/Artikel in API-Content
                var paragraphs = [];
                var allHeaders = tempDiv.querySelectorAll('h1, h2, h3, h4, .paragraph-number, .law-title');
                
                for (var i = 0; i < allHeaders.length; i++) {
                    var header = allHeaders[i];
                    var text = header.textContent.trim();
                    
                    // üîß FIX: √úberspringe Titel als separate Artikel
                    if (isLawTitle(text, lawConfig)) {
                        console.log('‚è≠Ô∏è √úberspringe Titel:', text);
                        continue;
                    }
                    
                    // Suche nach Paragraphen/Artikeln
                    var match = text.match(/(?:¬ß|Art\.?|Artikel)\s*(\d+)/i);
                    if (match) {
                        var num = parseInt(match[1], 10);
                        if (num > 0 && num < 1000) {
                            var title = text.replace(/(?:¬ß|Art\.?|Artikel)\s*\d+\s*[-‚Äì]?\s*/i, '').trim();
                            if (!title) title = (lawConfig.type === 'german-law' ? '¬ß ' : 'Art. ') + num;
                            
                            paragraphs.push({
                                number: num,
                                title: title,
                                id: 'para_' + num,
                                element: header
                            });
                            
                            console.log(`üìÑ ${lawConfig.type === 'german-law' ? '¬ß' : 'Art.'} ${num}: ${title}`);
                        }
                    }
                }
                
                if (paragraphs.length > 0) {
                    paragraphs.sort(function(a, b) { return a.number - b.number; });
                    sections = groupParagraphs(paragraphs, lawConfig);
                    extractAPIArticleContents(tempDiv, paragraphs, lawConfig);
                    return true;
                } else {
                    // Fallback: Erstelle einzelnen Artikel mit gesamtem Inhalt
                    console.log('üìÑ Keine Paragraphen gefunden, erstelle Gesamt-Artikel');
                    sections = [{
                        number: 1,
                        title: lawConfig.shortName + " - Gesetzestext",
                        articles: [{
                            number: 1,
                            title: "Vollst√§ndiger Gesetzestext",
                            id: "full_text"
                        }]
                    }];
                    
                    // Bereinige HTML f√ºr bessere Darstellung
                    var cleanContent = tempDiv.innerHTML;
                    cleanContent = '<div class="api-content">' + cleanContent + '</div>';
                    articleContents.set("full_text", cleanContent);
                    return true;
                }
            }
            
            function isLawTitle(text, lawConfig) {
                // Erkenne und √ºberspringe Gesetzestitel
                var titleIndicators = [
                    lawConfig.name,
                    lawConfig.shortName,
                    'gesetz',
                    'verordnung',
                    'grundverordnung'
                ];
                
                var lowerText = text.toLowerCase();
                for (var i = 0; i < titleIndicators.length; i++) {
                    if (lowerText.includes(titleIndicators[i].toLowerCase())) {
                        // Aber nicht wenn es auch Paragraph/Artikel-Nummer enth√§lt
                        if (!text.match(/(?:¬ß|Art\.?|Artikel)\s*\d+/i)) {
                            return true;
                        }
                    }
                }
                return false;
            }
            
            function parseEUContent(tempDiv, lawConfig) {
                console.log('üá™üá∫ Verarbeite EU-Content');
                
                var selectors = [
                    '[id^="art_"]',
                    '[id^="article_"]',
                    '[id^="Art"]',
                    '[id*="article"]'
                ];
                
                var articleElements = [];
                for (var s = 0; s < selectors.length; s++) {
                    var found = tempDiv.querySelectorAll(selectors[s]);
                    if (found.length > 0) {
                        console.log(`‚úÖ EU-Struktur gefunden (${selectors[s]}):`, found.length, 'Artikel');
                        articleElements = found;
                        break;
                    }
                }
                
                if (articleElements.length > 0) {
                    var allArticles = [];
                    var processedIds = new Set();
                    
                    for (var i = 0; i < articleElements.length; i++) {
                        var element = articleElements[i];
                        
                        if (processedIds.has(element.id)) continue;
                        processedIds.add(element.id);
                        
                        var match = element.id.match(/art[icle]*[_-]?(\d+)/i);
                        if (match) {
                            var num = parseInt(match[1], 10);
                            if (num > 0 && num < 1000) {
                                var title = extractEUTitle(element, num);
                                
                                allArticles.push({
                                    number: num,
                                    title: title,
                                    id: element.id
                                });
                                
                                console.log(`üìÑ Art. ${num}: ${title}`);
                            }
                        }
                    }
                    
                    if (allArticles.length > 0) {
                        allArticles.sort(function(a, b) { return a.number - b.number; });
                        sections = groupEUArticles(allArticles, lawConfig);
                        extractEUArticleContents(tempDiv, lawConfig);
                        return true;
                    }
                }
                
                return false;
            }
            
            function parseFallbackContent(tempDiv, lawConfig) {
                console.log('üìÑ Verarbeite Fallback-Content');
                
                sections = [{
                    number: 1,
                    title: "üìÑ Zugang zu " + lawConfig.shortName,
                    articles: [{
                        number: 1,
                        title: "Direkte Links zu offiziellen Quellen",
                        id: "fallback_info"
                    }]
                }];
                
                var content = tempDiv.innerHTML;
                articleContents.set("fallback_info", content);
                return true;
            }
            
            function extractEUTitle(element, articleNum) {
                var selectors = ['.oj-sti-art', '.eli-title', '.title', 'h1', 'h2', 'h3', 'strong', 'b'];
                
                for (var s = 0; s < selectors.length; s++) {
                    var titleEl = element.querySelector ? element.querySelector(selectors[s]) : null;
                    if (titleEl) {
                        var text = titleEl.textContent.trim();
                        if (text.length > 2 && text.length < 200) {
                            return text.replace(/^Artikel\s+\d+\s*[-‚Äì]?\s*/i, '');
                        }
                    }
                }
                
                var text = element.textContent.trim();
                if (text.length > 3 && text.length < 200) {
                    return text.replace(/^Artikel\s+\d+\s*[-‚Äì]?\s*/i, '');
                }
                
                return 'Artikel ' + articleNum;
            }
            
            function groupParagraphs(paragraphs, lawConfig) {
                switch (lawConfig.shortName) {
                    case 'GwG':
                        return groupGwGParagraphs(paragraphs);
                    case 'KWG':
                        return groupKWGParagraphs(paragraphs);
                    case 'StGB':
                        return groupStGBParagraphs(paragraphs);
                    default:
                        return groupDefaultParagraphs(paragraphs);
                }
            }
            
            function groupGwGParagraphs(paragraphs) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 5 },
                    { title: "Sorgfaltspflichten", start: 6, end: 15 },
                    { title: "Meldepflichten", start: 16, end: 20 },
                    { title: "Organisationspflichten", start: 21, end: 30 },
                    { title: "Aufsicht", start: 31, end: 50 },
                    { title: "Straf- und Bu√ügeldvorschriften", start: 51, end: 70 }
                ];
                return createSectionsFromRanges(ranges, paragraphs);
            }
            
            function groupKWGParagraphs(paragraphs) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 10 },
                    { title: "Erlaubnis und Beaufsichtigung", start: 11, end: 30 },
                    { title: "Gesch√§ftst√§tigkeit", start: 31, end: 50 },
                    { title: "Sondervorschriften", start: 51, end: 100 }
                ];
                return createSectionsFromRanges(ranges, paragraphs);
            }
            
            function groupStGBParagraphs(paragraphs) {
                var ranges = [
                    { title: "Geldw√§sche-relevante Bestimmungen", start: 260, end: 262 },
                    { title: "Weitere Straftatbest√§nde", start: 1, end: 300 }
                ];
                return createSectionsFromRanges(ranges, paragraphs);
            }
            
            function groupDefaultParagraphs(paragraphs) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 10 },
                    { title: "Hauptteil", start: 11, end: 50 },
                    { title: "Weitere Bestimmungen", start: 51, end: 100 },
                    { title: "Schlussbestimmungen", start: 101, end: 999 }
                ];
                return createSectionsFromRanges(ranges, paragraphs);
            }
            
            function groupEUArticles(allArticles, lawConfig) {
                switch (lawConfig.shortName) {
                    case 'GDPR':
                        return groupGDPRArticles(allArticles);
                    case 'AI Act':
                        return groupAIActArticles(allArticles);
                    case 'DSA':
                        return groupDSAArticles(allArticles);
                    default:
                        return groupAMLArticles(allArticles);
                }
            }
            
            function groupGDPRArticles(allArticles) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 4 },
                    { title: "Grunds√§tze", start: 5, end: 11 },
                    { title: "Rechte der betroffenen Person", start: 12, end: 23 },
                    { title: "Verantwortlicher und Auftragsverarbeiter", start: 24, end: 43 },
                    { title: "√úbermittlung an Drittl√§nder", start: 44, end: 50 },
                    { title: "Unabh√§ngige Aufsichtsbeh√∂rden", start: 51, end: 76 },
                    { title: "Zusammenarbeit und Koh√§renz", start: 77, end: 84 },
                    { title: "Rechtsbehelfe und Sanktionen", start: 85, end: 91 },
                    { title: "Schlussbestimmungen", start: 92, end: 99 }
                ];
                return createSectionsFromRanges(ranges, allArticles);
            }
            
            function groupAMLArticles(allArticles) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 8 },
                    { title: "Interne Strategien, Verfahren und Kontrollen", start: 9, end: 18 },
                    { title: "Sorgfaltspr√ºfung in Bezug auf Kunden", start: 19, end: 50 },
                    { title: "Transparenz des wirtschaftlichen Eigentums", start: 51, end: 68 },
                    { title: "Meldepflichten", start: 69, end: 75 },
                    { title: "Schlussbestimmungen", start: 76, end: 95 }
                ];
                return createSectionsFromRanges(ranges, allArticles);
            }
            
            function groupAIActArticles(allArticles) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 12 },
                    { title: "Verbotene KI-Praktiken", start: 13, end: 15 },
                    { title: "Hochrisiko-KI-Systeme", start: 16, end: 51 },
                    { title: "Transparenzpflichten", start: 52, end: 54 },
                    { title: "Governance und Umsetzung", start: 55, end: 78 },
                    { title: "Sanktionen", start: 79, end: 83 },
                    { title: "Schlussbestimmungen", start: 84, end: 113 }
                ];
                return createSectionsFromRanges(ranges, allArticles);
            }
            
            function groupDSAArticles(allArticles) {
                var ranges = [
                    { title: "Allgemeine Bestimmungen", start: 1, end: 6 },
                    { title: "Pflichten der Vermittlungsdienste", start: 7, end: 25 },
                    { title: "Online-Plattformen", start: 26, end: 39 },
                    { title: "Sehr gro√üe Online-Plattformen", start: 40, end: 68 },
                    { title: "Durchsetzung", start: 69, end: 87 },
                    { title: "Schlussbestimmungen", start: 88, end: 94 }
                ];
                return createSectionsFromRanges(ranges, allArticles);
            }
            
            function createSectionsFromRanges(ranges, allItems) {
                var result = [];
                
                for (var i = 0; i < ranges.length; i++) {
                    var range = ranges[i];
                    var sectionItems = [];
                    
                    for (var j = 0; j < allItems.length; j++) {
                        var item = allItems[j];
                        if (item.number >= range.start && item.number <= range.end) {
                            sectionItems.push(item);
                        }
                    }
                    
                    if (sectionItems.length > 0) {
                        result.push({
                            number: i + 1,
                            title: range.title,
                            articles: sectionItems
                        });
                    }
                }
                
                return result;
            }
            
            function extractAPIArticleContents(tempDiv, paragraphs, lawConfig) {
                console.log('üìÑ Extrahiere API-Artikel-Inhalte');
                
                for (var i = 0; i < paragraphs.length; i++) {
                    var para = paragraphs[i];
                    var content = '';
                    
                    if (para.element) {
                        var current = para.element;
                        var contentElements = [current];
                        
                        var next = current.nextElementSibling;
                        while (next && !isHeaderElement(next)) {
                            contentElements.push(next);
                            next = next.nextElementSibling;
                        }
                        
                        content = contentElements.map(function(el) {
                            return el.outerHTML;
                        }).join('\n');
                        
                        content = '<div class="api-content">' + content + '</div>';
                    } else {
                        content = '<div class="api-content"><p><em>Inhalt nicht verf√ºgbar.</em></p></div>';
                    }
                    
                    if (content.trim()) {
                        articleContents.set(para.id, content);
                    }
                }
                
                console.log('‚úÖ API-Artikel-Inhalte extrahiert:', articleContents.size);
            }
            
            function extractEUArticleContents(tempDiv, lawConfig) {
                var selectors = [
                    '[id^="art_"]',
                    '[id^="article_"]', 
                    '[id^="Art"]',
                    '[id*="article"]'
                ];
                
                var articleElements = [];
                for (var s = 0; s < selectors.length; s++) {
                    var found = tempDiv.querySelectorAll(selectors[s]);
                    if (found.length > 0) {
                        articleElements = found;
                        break;
                    }
                }
                
                console.log('üìÑ Extrahiere EU-Artikel-Inhalte:', articleElements.length);

                for (var i = 0; i < articleElements.length; i++) {
                    var article = articleElements[i];
                    var content = article.cloneNode(true);

                    var unwanted = content.querySelectorAll('script, style, .nav, .navigation, .breadcrumb');
                    for (var u = 0; u < unwanted.length; u++) {
                        unwanted[u].remove();
                    }

                    formatEUContent(content);

                    var cleanContent = content.innerHTML.trim();
                    if (cleanContent) {
                        articleContents.set(article.id, cleanContent);
                    }
                }

                console.log('‚úÖ EU-Artikel-Inhalte extrahiert:', articleContents.size);
            }
            
            function formatEUContent(contentDiv) {
                var normalPs = contentDiv.querySelectorAll('p');
                for (var p = 0; p < normalPs.length; p++) {
                    var para = normalPs[p];
                    var text = para.textContent.trim();
                    
                    var match = text.match(/^\((\d+)\)\s+(.+)$/);
                    if (match) {
                        var absatzNum = match[1];
                        var absatzText = match[2];
                        
                        para.innerHTML = 
                            '<div style="margin: 0.5em 0; padding-left: 1.5em; position: relative;">' +
                            '<span style="position: absolute; left: 0; font-weight: 500; color: #063AA8;">(' + absatzNum + ')</span>' +
                            absatzText +
                            '</div>';
                    }
                }
                
                var articleTitles = contentDiv.querySelectorAll('.oj-ti-art, .title, h1, h2, h3');
                for (var t = 0; t < articleTitles.length; t++) {
                    var titleP = articleTitles[t];
                    titleP.style.cssText = 'font-weight: 600; color: #063AA8; margin: 1em 0 0.5em 0; font-size: 1.1em;';
                }
            }
            
            function isHeaderElement(element) {
                if (!element) return false;
                var tagName = element.tagName.toLowerCase();
                return ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(tagName) ||
                       element.textContent.match(/(?:¬ß|Art\.?|Artikel)\s*\d+/) ||
                       element.classList.contains('law-title') ||
                       element.classList.contains('paragraph-number');
            }
            
            function loadFallback(lawConfig) {
                console.log('üîÑ Lade Fallback f√ºr:', lawConfig.name);
                
                sections = [{
                    number: 1,
                    title: "‚ö†Ô∏è Tempor√§rer Zugang",
                    articles: [{
                        number: 1,
                        title: "Direktlinks zu " + lawConfig.shortName,
                        id: "temp_fallback"
                    }]
                }];
                
                var fallbackContent = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>${lawConfig.name}</h3>
                        <p><strong>Tempor√§r nicht verf√ºgbar.</strong></p>
                        <p><a href="https://de.openlegaldata.io/" target="_blank">‚Üí Open Legal Data</a></p>
                        <p><a href="https://www.gesetze-im-internet.de/" target="_blank">‚Üí gesetze-im-internet.de</a></p>
                    </div>
                `;
                
                articleContents.set("temp_fallback", fallbackContent);
                renderSections();
            }
            
            function renderSections(filter) {
                if (!sections.length || !mainContent) return;
                
                var searchText = (filter || '').toLowerCase();
                var html = '';
                var hasResults = false;
                var lawConfig = AVAILABLE_LAWS[currentLaw];
                
                for (var i = 0; i < sections.length; i++) {
                    var section = sections[i];
                    var sectionHtml = '';
                    var sectionHasResults = false;
                    
                    for (var j = 0; j < section.articles.length; j++) {
                        var article = section.articles[j];
                        var prefix = getArticlePrefix(lawConfig);
                        var searchableText = (prefix + article.number + ' ' + article.title).toLowerCase();
                        var titleMatch = !searchText || searchableText.indexOf(searchText) !== -1;
                        var contentMatch = false;
                        
                        if (!titleMatch && searchText) {
                            var content = articleContents.get(article.id);
                            if (content) {
                                var contentText = content.toLowerCase();
                                contentMatch = contentText.indexOf(searchText) !== -1;
                            }
                        }
                        
                        if (titleMatch || contentMatch) {
                            var highlightedTitle = searchText ? highlightText(article.title, searchText) : article.title;
                            var badgeClass = getBadgeClass(lawConfig.shortName);
                            var contentTypeIndicator = getContentTypeIndicator();
                            
                            sectionHtml += '<div class="euaml-article' + (contentMatch ? ' euaml-content-match' : '') + '" data-article-id="' + article.id + '">';
                            sectionHtml += '<div class="euaml-article-title">';
                            sectionHtml += '<span>' + prefix + article.number + ' - ' + highlightedTitle + '</span>';
                            sectionHtml += '<div class="euaml-article-meta">';
                            sectionHtml += '<span class="law-badge ' + badgeClass + '">' + lawConfig.shortName + '</span>';
                            sectionHtml += contentTypeIndicator;
                            if (contentMatch) {
                                sectionHtml += '<span style="font-size: 0.85em; color: #0056b3; margin-left: 0.5em; padding: 2px 6px; border-radius: 4px; background-color: #e6f3ff;">(Treffer im Inhalt)</span>';
                            }
                            sectionHtml += '</div>';
                            sectionHtml += '</div>';
                            sectionHtml += '<div class="euaml-article-content"></div>';
                            sectionHtml += '</div>';
                            sectionHasResults = true;
                        }
                    }
                    
                    if (sectionHasResults) {
                        hasResults = true;
                        html += '<div class="euaml-section">';
                        html += '<div class="euaml-section-title">Abschnitt ' + section.number + ': ' + section.title;
                        if (lastUpdateTime) {
                            html += '<span class="euaml-update-time">Update: ' + lastUpdateTime.toLocaleString('de-DE') + '</span>';
                        }
                        html += '</div>';
                        html += sectionHtml;
                        html += '</div>';
                    }
                }
                
                if (!hasResults && searchText) {
                    html = '<div style="text-align: center; padding: 40px; color: #666;">Keine Ergebnisse f√ºr "' + filter + '" gefunden.</div>';
                }
                
                mainContent.innerHTML = html;
                bindEvents();
                console.log('‚úÖ Sections gerendert');
            }
            
            function getArticlePrefix(lawConfig) {
                return lawConfig.type === 'german-law' ? '¬ß ' : 'Art. ';
            }
            
            function getContentTypeIndicator() {
                if (currentContentType === 'api') {
                    return '<span class="content-type-indicator api">API</span>';
                } else if (currentContentType === 'eu-original') {
                    return '<span class="content-type-indicator">Original</span>';
                } else if (currentContentType === 'fallback') {
                    return '<span class="content-type-indicator fallback">Links</span>';
                }
                return '';
            }
            
            function getBadgeClass(shortName) {
                var badgeClasses = {
                    'EU-GwVO': 'eu-aml',
                    'GDPR': 'gdpr', 
                    'AI Act': 'ai-act',
                    'DSA': 'dsa',
                    'GwG': 'de-gwg',
                    'KWG': 'de-kwg',
                    'ZAG': 'de-zag',
                    'AWG': 'de-awg',
                    'AWV': 'de-awv',
                    'StGB': 'de-stgb',
                    'VAG': 'de-vag',
                    'KAGB': 'de-kagb',
                    'WpHG': 'de-wphg',
                    'EU-SanktDG': 'de-sanktdg'
                };
                
                return badgeClasses[shortName] || 'default';
            }
            
            function highlightText(text, searchTerm) {
                if (!searchTerm || searchTerm.length < 1) return text;
                var escapedTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                var regex = new RegExp('(' + escapedTerm + ')', 'gi');
                return text.replace(regex, '<span class="euaml-search-highlight">$1</span>');
            }
            
            function bindEvents() {
                var articles = mainContent.querySelectorAll('.euaml-article');
                
                for (var i = 0; i < articles.length; i++) {
                    articles[i].addEventListener('click', function(e) {
                        var selection = window.getSelection();
                        if (selection && selection.toString().trim().length > 0) {
                            return;
                        }
                        
                        var contentDiv = this.querySelector('.euaml-article-content');
                        if (contentDiv && contentDiv.contains(e.target)) {
                            return;
                        }
                        
                        toggleArticle(this);
                    });
                }
            }
            
            function toggleArticle(articleElement) {
                var articleId = articleElement.getAttribute('data-article-id');
                var wasActive = articleElement.classList.contains('euaml-active');
                
                var allArticles = mainContent.querySelectorAll('.euaml-article');
                for (var i = 0; i < allArticles.length; i++) {
                    if (allArticles[i] !== articleElement) {
                        allArticles[i].classList.remove('euaml-active');
                    }
                }
                
                if (wasActive) {
                    articleElement.classList.remove('euaml-active');
                    return;
                }
                
                articleElement.classList.add('euaml-active');
                loadArticleContent(articleElement, articleId);
            }
            
            function loadArticleContent(articleElement, articleId) {
                var contentDiv = articleElement.querySelector('.euaml-article-content');
                var content = articleContents.get(articleId);
                
                if (content) {
                    var searchTerm = searchInput ? searchInput.value.trim() : '';
                    var displayContent = content;
                    
                    if (searchTerm) {
                        displayContent = highlightInContent(content, searchTerm);
                    }
                    
                    contentDiv.innerHTML = 
                        '<div>' + displayContent + '</div>' +
                        '<div style="padding-top: 10px; border-top: 1px solid #eee; margin-top: 15px;">' +
                        '<button class="euaml-close-btn" onclick="this.closest(\'.euaml-article\').classList.remove(\'euaml-active\')">Schlie√üen</button>' +
                        '</div>';
                } else {
                    contentDiv.innerHTML = '<div><p><em>Artikel-Inhalt nicht verf√ºgbar.</em></p></div>';
                }
            }
            
            function highlightInContent(content, searchTerm) {
                if (!searchTerm || searchTerm.length < 2) return content;

                var tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;

                var searchTerms = searchTerm.toLowerCase().split(/\s+/).filter(function(term) {
                    return term.length > 1;
                });

                var walker = document.createTreeWalker(
                    tempDiv,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );

                var textNodes = [];
                var node;
                while (node = walker.nextNode()) {
                    textNodes.push(node);
                }

                for (var i = 0; i < textNodes.length; i++) {
                    var textNode = textNodes[i];
                    var text = textNode.textContent;
                    var highlightedText = text;

                    for (var j = 0; j < searchTerms.length; j++) {
                        var term = searchTerms[j];
                        var escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        var regex = new RegExp('(' + escapedTerm + ')', 'gi');
                        highlightedText = highlightedText.replace(regex, '<span class="euaml-search-highlight">$1</span>');
                    }

                    if (highlightedText !== text) {
                        var span = document.createElement('span');
                        span.innerHTML = highlightedText;
                        textNode.parentNode.replaceChild(span, textNode);
                    }
                }

                return tempDiv.innerHTML;
            }
            
            function handleSearch(searchText) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(function() {
                    renderSections(searchText);
                }, 300);
            }
            
            function initEventListeners() {
                if (lawSelector) {
                    lawSelector.addEventListener('change', function(e) {
                        currentLaw = e.target.value;
                        var lawConfig = AVAILABLE_LAWS[currentLaw];
                        
                        if (searchInput) {
                            searchInput.placeholder = 'Suche in ' + lawConfig.shortName + ' nach Artikeln oder Begriffen...';
                            searchInput.value = '';
                        }
                        
                        articleContents.clear();
                        sections = [];
                        currentContentType = 'unknown';
                        
                        loadFromGitHub(lawConfig);
                    });
                }
                
                if (searchInput) {
                    searchInput.addEventListener('input', function(e) {
                        handleSearch(e.target.value.trim());
                    });
                }
                
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', function() {
                        var lawConfig = AVAILABLE_LAWS[currentLaw];
                        articleContents.clear();
                        sections = [];
                        currentContentType = 'unknown';
                        
                        loadFromGitHub(lawConfig);
                    });
                }
            }
            
            function init() {
                console.log('üöÄ Initialisiere API-Powered Navigator...');
                
                if (!initElements()) {
                    console.error('‚ùå DOM-Elemente nicht gefunden');
                    return;
                }
                
                initEventListeners();
                
                var lawConfig = AVAILABLE_LAWS[currentLaw];
                loadFromGitHub(lawConfig);
                
                console.log('‚úÖ API-Powered Navigator initialisiert');
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
            
        })();
    </script>
</body>
</html>
